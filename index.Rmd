---
title: "MBON Pole to Pole Project"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message = F, warning = F)
```
<br>
<br>
<font size="5">
Welcome! We are developing a Community of Practice across the Americas to assess marine biodiversity and ecosystem change using field and space observations.
<br>
<br>
Ongoing biodiversity monitoring sites  

```{r}
library(tidyverse)
library(rnaturalearth) # install.packages("rnaturalearth")
library(sf)
library(leaflet)
library(here)
library(htmltools)

countries <- ne_countries(
  scale = "small", type = "countries", returnclass = "sf",
  continent= c("North America", "South America")) %>%
  mutate(
    mapcolor7 = as.factor(as.character(mapcolor7)))

sites_csv <- here("data/sites.csv")

sites <- read_csv(sites_csv) %>%
  st_as_sf(coords = c("longitude", "latitude"), crs = 4326)

# create column of html for popup
sites$html <- with(
    sites, paste("<iframe src='", popup_url, "'></iframe>", sep="")
)

b <- sf::st_bbox(sites)

pal <- colorFactor("Set2", countries$mapcolor7)
leaflet(countries) %>%
  addProviderTiles(
    providers$Esri.OceanBasemap,
    options = providerTileOptions(opacity = 0.5)) %>%
  addPolygons(
    stroke = FALSE, smoothFactor = 0.2, fillOpacity = 0.8,
    fillColor = ~pal(mapcolor7),
    label = ~admin) %>%
  addMarkers(
    data = sites,
    popup = ~html, label = ~htmlEscape(name)) %>%
  fitBounds(b[['xmin']], b[['ymin']], b[['xmax']], b[['ymax']])

```
