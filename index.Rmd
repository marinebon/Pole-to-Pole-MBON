---
title: "MBON Pole to Pole Project"
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message = F, warning = F)
```
<br>
<br>
<font size="5"> 
Welcome! We are developing a Community of Practice across the Americas to assess marine biodiversity and ecosystem change using field and space observations.
<br>
<br>
Ongoing biodiversity monitoring sites  

```{r}
library(tidyverse)
library(rnaturalearth) # install.packages("rnaturalearth")
library(sf)
library(leaflet)
library(here)
library(glue)
library(htmltools)
library(markdown)

countries <- ne_countries(
  scale = "small", type = "countries", returnclass = "sf",
  continent= c("North America", "South America")) %>%
  mutate(
    mapcolor7 = as.factor(as.character(mapcolor7)))

sites_csv <- here("data/sites.csv")

sites <- read_csv(sites_csv) %>% 
  st_as_sf(coords = c("lon", "lat"), crs = 4326)

b <- sf::st_bbox(sites)

pal <- colorFactor("Set2", countries$mapcolor7)
```

```{r}
sites <- read_csv(sites_csv) %>% 
  st_as_sf(coords = c("lon", "lat"), crs = 4326) %>% 
  mutate(
    md = glue("**{name}**<br>Org: {org}<br>Country: {str_to_upper(country)}<br>â†ª[ Visit](site/{id}.html)"),
    html = map_chr(md, function(x) HTML(markdownToHTML(text=x, fragment.only=T))))
#View(sites)

leaflet(countries) %>%
  addProviderTiles(
    providers$Esri.OceanBasemap, 
    options = providerTileOptions(opacity = 0.5)) %>%
  addPolygons(
    stroke = FALSE, smoothFactor = 0.2, fillOpacity = 0.8,
    fillColor = ~pal(mapcolor7),
    label = ~admin) %>% 
  addMarkers(
    data = sites, 
    popup = ~html, label = ~htmlEscape(name)) %>% 
  fitBounds(b[['xmin']], b[['ymin']], b[['xmax']], b[['ymax']])
```
