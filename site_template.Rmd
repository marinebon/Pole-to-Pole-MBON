---
title: "Site: `r params$site_name`"
params:
  site_name: "Isla Gorgona - La Mancora"
  site_id: "col-islagorgona-lamancora"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message = F)
```

```{r}
library(tidyverse)
library(knitr)
library(bsplus)
source("functions.R")

# params = list(site_id="usa-fknms")
# params = list(site_id="col-islagorgona-lamancora")
# params = list(site_id="bra-costadasalgas-gramute")
site <- read_csv(here("data/sites.csv")) %>% 
  filter(id == params$site_id)
photos <- read_csv(here("data/site_photos.csv")) %>% 
  filter(id == params$site_id)

sst <- info('jplMURSST41mday')
```

- Country: **`r str_to_upper(site$country)`**
- Organization: **`r site$org`**

## Photos

```{r}
if (nrow(photos) > 0){
  carousel <- bs_carousel(id = "photos", use_indicators = TRUE)
  
  for (i in 1:nrow(photos)){
    photo <- photos[i,]
    carousel <-  bs_append(
      carousel,
      content = bs_carousel_image(src = photo$url),
      caption = bs_carousel_caption(photo$caption))
  }
  
  carousel
} else {
  cat("No photos yet posted.")
}
```

## Map of SST

```{r}
box <- get_box(site$lon, site$lat, cells_wide=10)
r   <- get_raster(sst, lon=box$lon, lat=box$lat, date="last", field="sst")
map_raster(r, site_lon=site$lon, site_lat=site$lat, site_label=site$name, title="SST")
```

## Timeseries of SST

```{r}
csv <- here(glue("data/sst/sst_{site$id}.csv"))
d   <- get_timeseries(sst, lon=site$lon, lat=site$lat, csv=csv, field="sst")
plot_timeseries(d, title="SST", color="red")
```
